/**
 * lancet aop 工具
 *
 * @see https://github.com/eleme/lancet
 * @see https://code.byted.org/tanlehua/lancet
 * @see https://wiki.bytedance.net/pages/viewpage.action?pageId=173661273
 * @谭乐华
 */

apply plugin: 'me.ele.lancet'

lancet {
    if ("false".equalsIgnoreCase(findProperty("isLancetStrictMode"))) {
        strictMode false // true直接抛异常中断构建，false在build/lancet目录下输出error log
    } else {
        strictMode true
    }
    checkMethodNotFoundEnable false // 检查无用方法检查的开关
    useFileLog "lancet" // 配置输出log文件名
    checkUselessProxyMethodEnable true

    if (BuildContext.isDouyin()) {
        whiteListFilePath "config/lancet_extra/white_list.json"
        spi {
            spiServiceDirs "main/src/douyin/resources"
            injectClassName "com/ss/android/ugc/aweme/framework/services/ConfigLoader"
            proguardFilePath "app/proguard-rules-cn.pro"
        }
    } else if (BuildContext.isMusically()) {
        whiteListFilePath "config/lancet_extra/white_list.json", "config/lancet_extra/white_list_mt.json"
        spi {
            spiServiceDirs "main/src/i18n/resources", "main/sourcesets/i18n/resources",
                    "main/src/musically/resources"
            injectClassName "com/ss/android/ugc/aweme/framework/services/ConfigLoader"
            proguardFilePath "app/proguard-rules.pro"
        }
    } else if (BuildContext.isTiktok()) {
        whiteListFilePath "config/lancet_extra/white_list.json", "config/lancet_extra/white_list_mt.json"
        spi {
            spiServiceDirs "main/src/i18n/resources", "main/sourcesets/i18n/resources", "main/src/tiktok/resources"
            injectClassName "com/ss/android/ugc/aweme/framework/services/ConfigLoader"
            proguardFilePath "app/proguard-rules.pro"
        }
    }
}

if (BuildContext.isRelease()) {
    "rm -rf ${project.buildDir}/intermediates/transforms/lancet".execute()
}