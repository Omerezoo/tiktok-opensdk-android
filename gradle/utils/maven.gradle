/**
 * Shared file between builds so that they can all use the same dependencies and
 * maven repositories.
 * <p> from local.properties
 *
 * @see aweme maven 说明 https://wiki.bytedance.net/pages/viewpage.action?pageId=240235931
 *
 * @simple AWEME_MIRROR=origin   AWEME_MIRROR=bj
 * @parame 默认 无配置默认北京nexus代理  等同{@code AWEME_MIRROR=http://maven.byted.org/repository/android_public/}
 *         origin 原始maven，不使用任何代理  {@code AWEME_MIRROR=origin}
 *         http://xxx/ 自定义代理  {@code AWEME_MIRROR=http://10.15.65.92:8081/repository/aweme}
 *
 */
static def addRepos(RepositoryHandler handler) {
    def awemeMirror = currentMaven()
    handler.mavenLocal()
    if (awemeMirror != null && awemeMirror != "") {
        if ("origin" == awemeMirror) {
            handler.google()
            handler.maven { url "https://maven.byted.org/nexus/content/repositories/ugc_android/" }
            handler.maven { url 'https://maven.byted.org/nexus/content/repositories/ss_app_android/' }
            handler.maven { url 'https://maven.byted.org/nexus/content/repositories/central/' }
            handler.maven { url 'https://maven.byted.org/nexus/content/repositories/lark_android/' }
            handler.maven { url "https://maven.byted.org/nexus/content/repositories/ttplayer/" }
            handler.maven { url "https://maven.byted.org/nexus/content/repositories/ugc_android_snapshot/" }
            handler.maven { url "https://maven.byted.org/nexus/content/repositories/ss_app_android_snapshots/" }
            handler.maven { url 'https://maven.fabric.io/public' }
            handler.maven { url "https://plugins.gradle.org/m2/" }
            handler.maven { url "https://dl.bintray.com/c8682y/maven/" }
            handler.maven { url "http://dl.bintray.com/lukaville/maven" }
            handler.maven { url "https://dl.bintray.com/thelasterstar/maven/" }
            handler.maven { url "https://dl.bintray.com/thelasterstar/maven/" }
            handler.maven { url 'https://maven.google.com/' }

            // 第三方仓库
            handler.maven { url "https://storage.googleapis.com/snap-kit-build/maven" }
            handler.maven { url "http://devrepo.kakao.com:8088/nexus/content/groups/public/" }
            handler.jcenter()
            handler.mavenCentral()
        } else {
            handler.maven {
                url awemeMirror
            }
        }
    } else {
        /**
         *
         * <p> 新增maven步骤
         *     1.登录代理仓库后台（账号密码 admin admin123）增加
         *     2.在上面的origin条件增加maven地址
         * <p> 建议不要使用个人maven，尽量统一使用公司统一maven，尽量减少maven源数量
         * <p> 参考文档 https://wiki.bytedance.net/pages/viewpage.action?pageId=240235931
         */
        handler.maven {
            url defaultMaven()
        }
    }
}

static def defaultMaven() {
    return 'http://10.15.65.92:8081/repository/aweme'
}

static def currentMaven() {
    def awemeMirror = System.properties['AWEME_MIRROR']
    if (awemeMirror == null || awemeMirror == "") {
        awemeMirror = defaultMaven()
    }
    return awemeMirror
}

ext.currentMaven = this.&currentMaven
ext.addRepos = this.&addRepos